# ğŸ¤– Build Automation with GitHub Actions

This documentation was generated by AI, there may be errors.

This repository uses GitHub Actions to automatically build and update the `dist/` folder on every commit.

## ğŸ”§ Configuration

### GitHub Actions Workflow

**`advanced-build.yml`** - Robust and secure workflow that:
- Ignores commits that only modify `dist/` (prevents infinite loops)
- Automatically handles merge conflicts with retry logic
- Adds informative comments on Pull Requests
- Uses specific permissions for security
- Robust authentication with error handling

### ğŸš¦ Triggering

The workflow triggers on:
- âœ… Push to `main` branch
- âœ… Pull Request to `main`
- âŒ Modifications only in `dist/` (ignored to prevent loops)

## ğŸ› ï¸ Local Scripts

### To test the build locally:

**Linux/Mac:**
```bash
npm run test:build
```

**Windows:**
```powershell
npm run test:build:win
```

### Other useful commands:

```bash
# Normal build
npm run build

# Build with cleanup
npm run build:clean

# Development
npm run dev

# Preview build
npm run preview
```

## ğŸ“‹ Detailed Operation

### ğŸš€ Workflow Triggering

The `advanced-build.yml` workflow automatically triggers when:
- âœ… A commit is pushed to the `main` branch
- âœ… A Pull Request is opened to `main`

**But NOT when:**
- âŒ Only files in `dist/` are modified (prevents infinite loops)
- âŒ Only workflow files in `.github/workflows/` are modified

### ğŸ” Permissions and Security

```yaml
permissions:
  contents: write      # To commit dist/ files
  pull-requests: write # To comment on PRs
```

### ğŸ”§ Complete Execution Steps

#### **1. Code Checkout**
- ğŸ“¥ Downloads all repository code
- ğŸ”‘ Uses `GITHUB_TOKEN` for authentication
- ğŸ“š Retrieves full Git history (`fetch-depth: 0`)

#### **2. Node.js Configuration**
- ğŸŸ¢ Installs Node.js version 18
- ğŸš€ Enables npm cache to speed up future builds

#### **3. Dependencies Installation**
- ğŸ“¦ Uses `npm ci` (faster and more reliable than `npm install`)
- ğŸ§¹ Cleans `node_modules` and uses exactly `package-lock.json`

#### **4. Project Build**
- ğŸ”¨ Executes `npm run build` (which runs `vite build`)
- ğŸ“ Generates/updates the `dist/` folder with optimized files

#### **5. Changes Verification**
- ğŸ” Checks if the `dist/` folder exists
- ğŸ“ Adds all `dist/` files to Git staging
- ğŸ”„ Compares with previous version to detect changes
- ğŸ’¾ Stores the result (`has_changes=true/false`) for subsequent steps

#### **6. Commit and Push (Conditional)**
**Only executes IF:**
- âœ… Changes have been detected in `dist/`
- âœ… It's a direct `push` (not a Pull Request)

**Git Configuration:**
- ğŸ¤– Uses `github-actions[bot]` as author
- ğŸ“ Commit with detailed message including:
  - `[skip ci]` to avoid retriggering the workflow
  - Original commit ID
  - Name of the user who triggered the build

#### **7. Robust Conflict Management**
- ğŸ”„ Retry system with maximum 3 attempts
- ğŸ“¥ On failure: automatic pull and rebase
- âœ… Continues until success or final failure after 3 attempts
- ğŸ’¥ Clean stop with explicit error message

#### **8. PR Comment (Conditional)**
**Only executes IF:**
- âœ… It's a Pull Request
- âœ… Changes would have been made in `dist/`

**Action:**
- ğŸ’¬ Adds an informative comment to the PR
- ğŸ“ Indicates that the build succeeded and `dist/` would be updated

### ğŸ¯ Complete Flow Summary

```
Commit â†’ Trigger â†’ Checkout â†’ Setup Node.js â†’ Install deps
    â†“
Build project â†’ Check changes â†’ [If changes detected]
    â†“
Auto commit â†’ Push with retry â†’ [Success or failure after 3 attempts]
    â†“
[If PR] Informative comment
```

## ğŸ“‹ Simplified Operation

1. **Source code commit** â†’ GitHub Actions detects the change
2. **Installation** â†’ `npm ci` to install dependencies
3. **Build** â†’ `npm run build` generates/updates `dist/`
4. **Verification** â†’ Checks if there are changes in `dist/`
5. **Auto commit** â†’ If changes detected, commit with `[skip ci]` message
6. **Secure push** â†’ Pushes changes with automatic conflict management

## âš ï¸ Important Points

### ğŸ”„ Infinite Loop Prevention
- Commit message contains `[skip ci]` to avoid retriggering the workflow
- `paths-ignore` filters to ignore modifications in `dist/` and `.github/workflows/`

### ğŸ“ dist/ Folder Management
- The `dist/` folder is **tracked** by Git (contrary to usual practice)
- Automatically updated on every source code change
- Versioned to ensure consistency between code and its built version

### ğŸ¤– Automatic Commits
- Author: `github-actions[bot]@users.noreply.github.com`
- Detailed messages with traceability information
- Timestamp and reference to triggering commit

### ğŸ›¡ï¸ Conflict Management
- Automatic retry system (maximum 3 attempts)
- Automatic pull and rebase on conflict
- Clean stop with explicit error message if persistent failure

### ğŸ” Permissions and Security
- Uses automatic `GITHUB_TOKEN` (no need for Personal Access Token)
- Minimum required permissions: `contents: write` and `pull-requests: write`
- Execution only on authorized branches (`main`)

### ğŸ“Š Monitoring and Debugging
- Detailed logs at each step
- Informative messages for operation tracking
- Explicit exit codes to identify issues

## ğŸ” Monitoring and Debugging

### ğŸ“Š Workflow Tracking
- **Actions tab** of your GitHub repository to see complete history
- **Detailed logs** for each execution step
- **Notifications** on workflow failure

### ğŸ› Debugging Common Issues

#### Issue: Write permissions denied (403)
**Solution:**
1. Repository â†’ Settings â†’ Actions â†’ General
2. Select "Read and write permissions"
3. Check "Allow GitHub Actions to create and approve pull requests"

#### Issue: Infinite build loop
**Automatic solution:**
- `paths-ignore` filters prevent triggering on `dist/`
- `[skip ci]` flag in commit message

#### Issue: Persistent merge conflicts
**Automatic solution:**
- Retry system with 3 attempts
- Automatic pull and rebase
- Clean stop if impossible to resolve

### ğŸ“ˆ Performance Metrics
- **Build time**: Generally 2-3 minutes
- **npm cache**: Reduces dependency installation time
- **Retry logic**: Increases reliability to ~99%

## ğŸ›¡ï¸ Security and Best Practices

### ğŸ” Authentication
- **Automatic GITHUB_TOKEN**: No need for Personal Access Token
- **Minimal permissions**: Only `contents: write` and `pull-requests: write`
- **Limited scope**: Execution only on `main` branch

### ğŸš¦ Security Controls
- **Trigger filters**: Avoids unnecessary executions
- **Change validation**: Checks before committing
- **Environment isolation**: Each build in a clean environment

### ğŸ“‹ Implemented Best Practices
- **npm ci** instead of `npm install` for reproducibility
- **Dependency caching** for efficiency
- **Informative commit messages** for traceability
- **Robust error handling** for reliability
- **Detailed logs** for debugging

### ğŸ”„ Maintenance
- **Auto-update actions**: Uses stable versions (v4)
- **Automatic monitoring**: Notifications on failure
- **Documentation**: Complete guide for maintenance

---

## ğŸ‰ Final Result

With this system, your development workflow becomes fully automated:

1. **You commit** your source code
2. **GitHub Actions** builds automatically
3. **The dist/ folder** is updated automatically
4. **Your webhook** redeploys with the latest version

**Zero manual intervention required!** ğŸš€
