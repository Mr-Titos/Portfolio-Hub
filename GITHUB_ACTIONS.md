# 🤖 Build Automation with GitHub Actions

This documentation was generated by AI, there may be errors.

This repository uses GitHub Actions to automatically build and update the `dist/` folder on every commit.

## 🔧 Configuration

### GitHub Actions Workflow

**`advanced-build.yml`** - Robust and secure workflow that:
- Ignores commits that only modify `dist/` (prevents infinite loops)
- Automatically handles merge conflicts with retry logic
- Adds informative comments on Pull Requests
- Uses specific permissions for security
- Robust authentication with error handling

### 🚦 Triggering

The workflow triggers on:
- ✅ Push to `main` branch
- ✅ Pull Request to `main`
- ❌ Modifications only in `dist/` (ignored to prevent loops)

## 🛠️ Local Scripts

### To test the build locally:

**Linux/Mac:**
```bash
npm run test:build
```

**Windows:**
```powershell
npm run test:build:win
```

### Other useful commands:

```bash
# Normal build
npm run build

# Build with cleanup
npm run build:clean

# Development
npm run dev

# Preview build
npm run preview
```

## 📋 Detailed Operation

### 🚀 Workflow Triggering

The `advanced-build.yml` workflow automatically triggers when:
- ✅ A commit is pushed to the `main` branch
- ✅ A Pull Request is opened to `main`

**But NOT when:**
- ❌ Only files in `dist/` are modified (prevents infinite loops)
- ❌ Only workflow files in `.github/workflows/` are modified

### 🔐 Permissions and Security

```yaml
permissions:
  contents: write      # To commit dist/ files
  pull-requests: write # To comment on PRs
```

### 🔧 Complete Execution Steps

#### **1. Code Checkout**
- 📥 Downloads all repository code
- 🔑 Uses `GITHUB_TOKEN` for authentication
- 📚 Retrieves full Git history (`fetch-depth: 0`)

#### **2. Node.js Configuration**
- 🟢 Installs Node.js version 18
- 🚀 Enables npm cache to speed up future builds

#### **3. Dependencies Installation**
- 📦 Uses `npm ci` (faster and more reliable than `npm install`)
- 🧹 Cleans `node_modules` and uses exactly `package-lock.json`

#### **4. Project Build**
- 🔨 Executes `npm run build` (which runs `vite build`)
- 📁 Generates/updates the `dist/` folder with optimized files

#### **5. Changes Verification**
- 🔍 Checks if the `dist/` folder exists
- 📝 Adds all `dist/` files to Git staging
- 🔄 Compares with previous version to detect changes
- 💾 Stores the result (`has_changes=true/false`) for subsequent steps

#### **6. Commit and Push (Conditional)**
**Only executes IF:**
- ✅ Changes have been detected in `dist/`
- ✅ It's a direct `push` (not a Pull Request)

**Git Configuration:**
- 🤖 Uses `github-actions[bot]` as author
- 📝 Commit with detailed message including:
  - `[skip ci]` to avoid retriggering the workflow
  - Original commit ID
  - Name of the user who triggered the build

#### **7. Robust Conflict Management**
- 🔄 Retry system with maximum 3 attempts
- 📥 On failure: automatic pull and rebase
- ✅ Continues until success or final failure after 3 attempts
- 💥 Clean stop with explicit error message

#### **8. PR Comment (Conditional)**
**Only executes IF:**
- ✅ It's a Pull Request
- ✅ Changes would have been made in `dist/`

**Action:**
- 💬 Adds an informative comment to the PR
- 📝 Indicates that the build succeeded and `dist/` would be updated

### 🎯 Complete Flow Summary

```
Commit → Trigger → Checkout → Setup Node.js → Install deps
    ↓
Build project → Check changes → [If changes detected]
    ↓
Auto commit → Push with retry → [Success or failure after 3 attempts]
    ↓
[If PR] Informative comment
```

## 📋 Simplified Operation

1. **Source code commit** → GitHub Actions detects the change
2. **Installation** → `npm ci` to install dependencies
3. **Build** → `npm run build` generates/updates `dist/`
4. **Verification** → Checks if there are changes in `dist/`
5. **Auto commit** → If changes detected, commit with `[skip ci]` message
6. **Secure push** → Pushes changes with automatic conflict management

## ⚠️ Important Points

### 🔄 Infinite Loop Prevention
- Commit message contains `[skip ci]` to avoid retriggering the workflow
- `paths-ignore` filters to ignore modifications in `dist/` and `.github/workflows/`

### 📁 dist/ Folder Management
- The `dist/` folder is **tracked** by Git (contrary to usual practice)
- Automatically updated on every source code change
- Versioned to ensure consistency between code and its built version

### 🤖 Automatic Commits
- Author: `github-actions[bot]@users.noreply.github.com`
- Detailed messages with traceability information
- Timestamp and reference to triggering commit

### 🛡️ Conflict Management
- Automatic retry system (maximum 3 attempts)
- Automatic pull and rebase on conflict
- Clean stop with explicit error message if persistent failure

### 🔐 Permissions and Security
- Uses automatic `GITHUB_TOKEN` (no need for Personal Access Token)
- Minimum required permissions: `contents: write` and `pull-requests: write`
- Execution only on authorized branches (`main`)

### 📊 Monitoring and Debugging
- Detailed logs at each step
- Informative messages for operation tracking
- Explicit exit codes to identify issues

## 🔍 Monitoring and Debugging

### 📊 Workflow Tracking
- **Actions tab** of your GitHub repository to see complete history
- **Detailed logs** for each execution step
- **Notifications** on workflow failure

### 🐛 Debugging Common Issues

#### Issue: Write permissions denied (403)
**Solution:**
1. Repository → Settings → Actions → General
2. Select "Read and write permissions"
3. Check "Allow GitHub Actions to create and approve pull requests"

#### Issue: Infinite build loop
**Automatic solution:**
- `paths-ignore` filters prevent triggering on `dist/`
- `[skip ci]` flag in commit message

#### Issue: Persistent merge conflicts
**Automatic solution:**
- Retry system with 3 attempts
- Automatic pull and rebase
- Clean stop if impossible to resolve

### 📈 Performance Metrics
- **Build time**: Generally 2-3 minutes
- **npm cache**: Reduces dependency installation time
- **Retry logic**: Increases reliability to ~99%

## 🛡️ Security and Best Practices

### 🔐 Authentication
- **Automatic GITHUB_TOKEN**: No need for Personal Access Token
- **Minimal permissions**: Only `contents: write` and `pull-requests: write`
- **Limited scope**: Execution only on `main` branch

### 🚦 Security Controls
- **Trigger filters**: Avoids unnecessary executions
- **Change validation**: Checks before committing
- **Environment isolation**: Each build in a clean environment

### 📋 Implemented Best Practices
- **npm ci** instead of `npm install` for reproducibility
- **Dependency caching** for efficiency
- **Informative commit messages** for traceability
- **Robust error handling** for reliability
- **Detailed logs** for debugging

### 🔄 Maintenance
- **Auto-update actions**: Uses stable versions (v4)
- **Automatic monitoring**: Notifications on failure
- **Documentation**: Complete guide for maintenance

---

## 🎉 Final Result

With this system, your development workflow becomes fully automated:

1. **You commit** your source code
2. **GitHub Actions** builds automatically
3. **The dist/ folder** is updated automatically
4. **Your webhook** redeploys with the latest version

**Zero manual intervention required!** 🚀
